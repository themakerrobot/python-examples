<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello World</title>
    <script src="../static/socket.io.js"></script>
    <script>
      window.onload = () =>{
        const socket = io('ws://' + window.location.host, {path:'/ws/socket.io'});

        // Motion
        const mh_up_bt = document.getElementById("mh_up_bt");
        const mh_down_bt = document.getElementById("mh_down_bt");
        const mh_left_bt = document.getElementById("mh_left_bt");
        const mh_right_bt = document.getElementById("mh_right_bt");

        const m_forward_bt = document.getElementById("m_forward_bt");
        const m_backward_bt = document.getElementById("m_backward_bt");
        const m_left_bt = document.getElementById("m_left_bt");
        const m_right_bt = document.getElementById("m_right_bt");
        const m_stop_bt = document.getElementById("m_stop_bt");

        mh_up_bt.addEventListener("click", function(){socket.emit("set_motor", [0, -1])});
        mh_down_bt.addEventListener("click", function(){socket.emit("set_motor", [0, 1])});
        mh_left_bt.addEventListener("click", function(){socket.emit("set_motor", [1, 0])});
        mh_right_bt.addEventListener("click", function(){socket.emit("set_motor", [-1, 0])});

        socket.emit("head_value");
        socket.on("m_head_value", function(d){
          document.getElementById("mh_value").textContent =  "↔: " + d[0] + ", ↕: " + d[1];
        });

        m_forward_bt.addEventListener("click", function(){socket.emit("set_motion", "forward1");});
        m_backward_bt.addEventListener("click", function(){socket.emit("set_motion", "backward1");});
        m_left_bt.addEventListener("click", function(){socket.emit("set_motion", "left");});
        m_right_bt.addEventListener("click", function(){socket.emit("set_motion", "right");});
        m_stop_bt.addEventListener("click", function(){socket.emit("set_motion", "stop");});

        // Device
        const d_oled_in = document.getElementById("d_oled_in");
        const d_led_in = document.getElementById("d_led_in");
        const d_info = document.getElementById("d_info");

        d_oled_in.addEventListener("keypress", function(evt){
          if (evt.keyCode == 13){
            socket.emit("set_oled",d_oled_in.value);
            d_oled_in.value = "";
          }
        });

        d_led_in.addEventListener("keypress", function(evt){
          if (evt.keyCode == 13){
            socket.emit("set_led", d_led_in.value);
            d_led_in.value ="";
          }
        });

        socket.on("device", function(dlst){
          let tmp = "";
          for(key in dlst){
            tmp += key.toUpperCase() + ": <b>" + dlst[key] + "</b>, "; 
          }
          tmp = tmp.slice(0, tmp.length-2);
          d_info.innerHTML = "<i>" + tmp + "</i>";
        });

        // Vision
        const v_image = document.getElementById('v_image');
        const v_result = document.getElementById('v_result');
        socket.on("vision", function(res){
          v_image.src = res['image'];
          v_result.innerHTML = res['result'].join("<br>")
        });

      }
    </script>
    <style>
      body {
        background-color:white;
      }

      td {
        width:160px;
        text-align: center;
      }

      button {
        border: 1px solid black;
        width:100%;
        background: whitesmoke;
        border-radius: 5px;
      }

      button:hover {
	      box-shadow: inset 0 0 0 2em rgba(0, 0, 0, 0.05);
      }

      input {
        width:95%;
      }

      img {
        width:320px;
        height:240px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <h2>RoBoTCoN</h2>

    <table>
      <tr><td colspan="3"><h3>Device</h3></td></tr>
      <tr>
        <td colspan="3"><span id="d_info"></span></td>
      </tr>
      <tr>
        <td>OLED</td>
        <td colspan="2"><input type="text" id="d_oled_in" placeholder="Hello World" /></td>
      </tr>
      <tr>
        <td>LED</td>
        <td colspan="2"><input type="text" id="d_led_in" placeholder="0,0,0,0,0,0" /></td>
      </tr>

      <tr><td colspan="3"><h3>Motion</h3></td></tr>
      <tr>
        <td colspan="3"><button id="m_forward_bt">Forward</button></td>
      </tr>
      <tr>
        <td><button id="m_left_bt">Left</button></td>
        <td><button id="m_stop_bt">Stop</button></td>
        <td><button id="m_right_bt">Right</button></td>
      </tr>
      <tr>
        <td colspan="3"><button id="m_backward_bt">Backward</button></td>
      </tr>

      <tr><td colspan="3"><h3>Vision</h3><span id="mh_value"></span></td></tr>
      <tr>
        <td colspan="2"><img id="v_image"></img></td>
        <td><span id="v_result"></span></td>
      </tr>

      <tr>
        <td></td>
        <td><button id="mh_up_bt">▲</button></td>
        <td></td>
      </tr>
      <tr>
        <td><button id="mh_left_bt">◀</button></td>
        <td><button id="mh_down_bt">▼</button></td>
        <td><button id="mh_right_bt">▶</button></td>
      </tr>

    </table>
  </body>
 </html>